<!DOCTYPE html>
<html>
<head>
<title>EasyScore</title>
<meta name="viewport"
	content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />
    <meta charset="utf-8" />
<!-- SCRIPTS VEXXX MUSICXML -->
<!-- VexFlow Sources -->
<script src="src/vex.js"></script>
<script src="src/flow.js"></script>
<script src="src/fraction.js"></script>
<script src="src/fonts/vexflow_font.js"></script>
<script src="src/glyph.js"></script>
<script src="src/tables.js"></script>
<script src="src/stave.js"></script>
<script src="src/staveconnector.js"></script>
<script src="src/voice.js"></script>
<script src="src/voicegroup.js"></script>
<script src="src/modifier.js"></script>
<script src="src/modifiercontext.js"></script>
<script src="src/accidental.js"></script>
<script src="src/dot.js"></script>
<script src="src/tickcontext.js"></script>
<script src="src/tickable.js"></script>
<script src="src/note.js"></script>
<script src="src/bend.js"></script>
<script src="src/stem.js"></script>
<script src="src/notehead.js"></script>
<script src="src/stemmablenote.js"></script>
<script src="src/stavenote.js"></script>
<script src="src/tabnote.js"></script>
<script src="src/barnote.js"></script>
<script src="src/clefnote.js"></script>
<script src="src/timesignote.js"></script>
<script src="src/ghostnote.js"></script>
<script src="src/formatter.js"></script>
<script src="src/stavetie.js"></script>
<script src="src/stavehairpin.js"></script>
<script src="src/tabtie.js"></script>
<script src="src/tabslide.js"></script>
<script src="src/beam.js"></script>
<script src="src/vibrato.js"></script>
<script src="src/annotation.js"></script>
<script src="src/tuning.js"></script>
<script src="src/stavemodifier.js"></script>
<script src="src/keysignature.js"></script>
<script src="src/timesignature.js"></script>
<script src="src/clef.js"></script>
<script src="src/music.js"></script>
<script src="src/keymanager.js"></script>
<script src="src/renderer.js"></script>
<script src="src/stavebarline.js"></script>
<script src="src/stavevolta.js"></script>
<script src="src/staverepetition.js"></script>
<script src="src/stavesection.js"></script>
<script src="src/stavetempo.js"></script>
<script src="src/stavetext.js"></script>
<script src="src/raphaelcontext.js"></script>
<script src="src/canvascontext.js"></script>
<script src="src/tuplet.js"></script>
<script src="src/boundingbox.js"></script>
<script src="src/textnote.js"></script>
 
<script src="src/measure.js"></script>
<script src="src/musicxml.js"></script>
<script src="src/document.js"></script>
<script src="src/documentformatter.js"></script>
 
<!-- Test Sources -->
<link rel="stylesheet" href="src/qunit.css" type="text/css"
	media="screen" />
<script src="src/qunit.js"></script>
<!--  script src="src/vexflow_test_helpers.js"></script-->
<!--  script src="js/document_web.js"></script -->
<script src="js/part_complete.js"></script>
<script src="js/part_simples.js"></script>
<!-- END OF MUSICXML -->
 
<script src="js/websocket.js"></script>
<link rel="stylesheet" type="text/css" href="js/af.ui.css" />
<link rel="stylesheet" type="text/css" href="js/icons.css" />
<script type="text/javascript" charset="utf-8"
	src="js/appframework.ui.min.js"></script>
<!-- N�O DEIXA APARECER O CHECKBOX -->
<!--AppFramework plugin for sliding side menu-->
<script type="text/javascript" charset="utf-8" src="js/af.slidemenu.js"></script>
<script src="cordova.js"></script>

<script src='js/getFiles.js'></script> 
 
<style text="text/css">
#exibePart {
	background-color: #eed;
	background: #eed;
}
 
#exibe_info {
	background-color: #eed;
	background: #eed;
}
 
canvas {
	background: #eed;
}
 
div.egcode {
	font-family: Courier;
	font-size: 14px;
}

footer {
	padding: 10px;
}
/*header {
	position: absolute;
	top:0px;
	left:0px;
}

header.button.icon.settings{
	position: absolute;
	top:0px;
	right:0px;
}*/
</style>
</head>
<body>
	<div id="afui">
		<aside>
			<ul class="list">
				<li id="consultarEstudios"><a href="#mainpage">Consultar Estúdios</a></li>
				<li><a href="#upload">Carregar Partitura</a></li>
				<li><a href="#criaEstudio">Criar Estúdio</a></li>
				<li><a href="#configuracoes">Configurações</a></li>
				<li><a href="#selecionaExemplo">Exemplos de Partituras</a></li>
			</ul>
		</aside>
		
		<header class="container-group inner-element uib_w_1"
			data-uib="app_framework/header" data-ver="0" id="af-header">
			<a onclick='$.ui.toggleRightSideMenu()'
				class='button icon settings' style="float: right"></a>
			<h1>EasyScore</h1>
		</header>
		
		<div id="content" class="uwrap">
			<div class="upage panel" id="mainpage" data-header="af-header"
				data-footer="af-footer">
				<div class="upage-content" id="mainsub">
					<ul class="list widget uib_w_2 d-margins"
						data-uib="app_framework/listview" id="listaEstudios" data-ver="0">
						<li><a href="selecionaPart">
								Estúdio 1 </a></li>
						<li><a href="#selecionaPart">
								Estúdio 2 </a></li>
					</ul>
				</div>
				<!-- /upage-content -->
			</div>	<!-- /Main -->
			<!--M�sica_Info-->
			<div class="upage panel" id="upload" data-header="af-header-upload"
				data-footer="af-footer">
				<header class="container-group inner-element uib_w_10"
					data-uib="app_framework/header" data-ver="0" id="af-header-upload">
					<a onclick='$.ui.toggleRightSideMenu()'
						class='button icon settings' style="float: right"></a>
					<h1>Carregar Partitura</h1>
				</header>
				<div id="upload_info" class="upage-content">
					<br />
					<input id="nome_part" type="text" placeholder="nome da partitura" />
					<input id="arquivo" type="text" placeholder="caminho do arquivo" />
					<a class="button" data-uib="app_framework/button"
						id="btn_upload" href="#mainpage" data-ver="0">Enviar</a>
					<br/>
					<br/>
					<br/>
					<a class="button" data-uib="app_framework/button"
						id="btn_le" href="#" data-ver="0">Lê Arquivo</a>
					<textarea id="res_botao" rows="10" cols="50"></textarea>
				</div>
			</div>
			<!-- Upload Partitura -->
			<div class="upage panel" id="criaEstudio"
				data-header="af-header-criaEstudio" data-footer="af-footer">
				<header class="container-group inner-element uib_w_10"
					data-uib="app_framework/header" data-ver="0"
					id="af-header-criaEstudio">
					<a onclick='$.ui.toggleRightSideMenu()'
						class='button icon settings' style="float: right"></a>
					<h1>Criar Estúdio</h1>
				</header>
				<div id="criaEstudio_info" class="upage-content">
					<br /> <input type="text" required id="criaNomeEstudio"
						placeholder="nome do Estúdio" />
					<a class="button" href="#selecionaPartEst" id="btn_criaEstudio"
						data-uib="app_framework/button" data-ver="0">Criar</a>
				</div>
			</div>
			<!-- /Criar Estúdio -->
			<div class="upage panel" id="selecionaPartEst"
				data-header="af-header-selecionaPartEst" data-footer="af-footer">
				<header class="container-group inner-element uib_w_10"
					data-uib="app_framework/header" data-ver="0"
					id="af-header-selecionaPartEst">
					<a onclick='$.ui.toggleRightSideMenu()'
						class='button icon settings' style="float: right"></a>
					<h1>Estúdio</h1>
				</header>
				<div id="criaEstudio_info" class="upage-content">
					<ul class="list widget uib_w_2 d-margins"
						data-uib="app_framework/listview" id="listaPartEst" data-ver="0">
						<li><input type="checkbox"/>Estúdio 1 - Trompete</li>
						<li><input type="checkbox"/>Estúdio 1 - Trombone</li>
						<li><input type="checkbox"/>Estúdio 1 - Clarinete</li>
						<li><input type="checkbox"/>Estúdio 2 - Tuba</li>
						<li><input type="checkbox"/>Estúdio 2 - Clarinete</li>
						<li><input type="checkbox"/>Estúdio 2 - Saxofone</li>
						<li><input type="checkbox"/>Estúdio 3 - Clarinete</li>
					</ul>
					<a class="button" data-uib="app_framework/button" data-ver="0" 
						id="btn_comecar" href="#mainpage">Selecionar</a>
				</div>
			</div>
			<!-- /MAESTRO - Selecionar Partituras do Estúdio -->
			<div class="upage panel" id="selecionaPart"
				data-header="af-header-selecionaPart" data-footer="af-footer">
				<header class="container-group inner-element uib_w_10"
					data-uib="app_framework/header" data-ver="0"
					id="af-header-selecionaPart">
					<a onclick='$.ui.toggleRightSideMenu()'
						class='button icon settings' style="float: right"></a>
					<h1>Estúdio</h1>
				</header>
				<div id="selecionaPart_info" class="upage-content">
					<ul class="list widget uib_w_2 d-margins"
						data-uib="app_framework/listview" id="listaPart" data-ver="0">
						<li>Estúdio - Partitura 1</li>
					</ul>
					<a class="button" data-uib="app_framework/button" data-ver="0" 
						id="btn_selecionaPart" href="#mainpage">Receber</a>
						<br/>
						<br/>
					<a class="button" data-uib="app_framework/button" data-ver="0" 
						id="btn_comecar" href="#exibePart">Começar</a>
				</div>
			</div>
			<!-- /M�SICO - Selecionar Partituras -->
			<div class="upage panel" id="configuracoes"
				data-header="af-header-configuracoes" data-footer="af-footer">
				<header class="container-group inner-element uib_w_10"
					data-uib="app_framework/header" data-ver="0"
					id="af-header-configuracoes">
					<a onclick='$.ui.toggleRightSideMenu()'
						class='button icon settings' style="float: right"></a>
					<h1>Configurações</h1>
				</header>
				<div id="configuracoes_info" class="upage-content">
					<br />
					<br />
					<label>Altura e Largura da Partitura</label>
					<input type="range" min="750" max="2050" value="750" step="100" onchange='showValue(this.value, "rangeAltura")' />
					<br/>
					<span style="width:auto" id="rangeAltura">750</span>
					<br />
					<br />
					<label>Escala da Partitura</label>
					<input type="range" min="1" max="3" value="1" step="0.5" onchange='showValue(this.value, "rangeEscala")' />
					<br/>
					<span style="width:auto" id="rangeEscala">1</span>
					<br />
					<br />
					<br />
					<br />
					<label>Velocidade</label>
					<input type="range" min="1" max="3" value="1" step="0.5" onchange='showValue(this.value, "rangeVelocidade")' />
					<br/>
					<span style="width:auto" id="rangeVelocidade">1</span>
					<br />
					<script type="text/javascript">
						function showValue(newValue, id)
						{
							document.getElementById(id).innerHTML=newValue;
						}
					</script>
					<br />
					<button class="button widget uib_w_14 d-margins"
						data-uib="app_framework/button" data-ver="0"
						id="btn_configuracoes" data-transition="fade">Gravar</button>
				</div>
			</div>
			<!-- /Configurações -->
			<div class="upage panel" id="selecionaPart"
				data-header="af-header-selecionaPart" data-footer="af-footer">
				<header class="container-group inner-element uib_w_10"
					data-uib="app_framework/header" data-ver="0"
					id="af-header-selecionaPart">
					<a onclick='$.ui.toggleRightSideMenu()'
						class='button icon settings' style="float: right"></a>
					<h1>Estúdio</h1>
				</header>
				<div id="selecionaPart_info" class="upage-content">
					<ul class="list widget uib_w_2 d-margins"
						data-uib="app_framework/listview" id="listaPart" data-ver="0">
						<li>Estúdio - Partitura 1</li>
					</ul>
					<a class="button" data-uib="app_framework/button" data-ver="0" 
						id="btn_notificar" href="#exibePart">Começar</a>
				</div>
			</div>
			<div class="upage panel" id="selecionaExemplo"
				data-header="af-header-selecionaExe" data-footer="af-footer">
				<header class="container-group inner-element uib_w_10"
					data-uib="app_framework/header" data-ver="0"
					id="selecionaExe">
					<a onclick='$.ui.toggleRightSideMenu()'
						class='button icon settings' style="float: right"></a>
					<h1>Exemplos</h1>
				</header>
				<div id="selecionaExe_info" class="upage-content">
					<!-- form name = "radiosForm" -->
					<ul class="list widget uib_w_2 d-margins"
						data-uib="app_framework/listview" id="listaPart" data-ver="0">
						<li>Echigo-Jishi</li>
					</ul>
					<!-- /form>
					
					<li><input type="radio" name="radios" value="1" id="ishigo" checked />Echigo-Jishi</li>
					<script>
					var rad = document.radiosForm.radios;
					var prev = null;
					for(var i = 0; i < rad.length; i++) {
					    rad[i].onclick = function() {
					        if(this !== prev) {
					            prev = this;
					        }
					    };
					}
					</script -->
					<a class="button" data-uib="app_framework/button" data-ver="0" 
						id="btn_comecarExemplo" href="#exibePart">Começar</a>
				</div>
			</div>
			<!-- Exibe exemplo -->
			<div class="upage panel" id="exibePart"
				data-header="af-header" data-footer="af-footer" js-scrolling="false">
				<header class="container-group inner-element uib_w_10"
					data-uib="app_framework/header" data-ver="0"
					id="af-header-exibePart">
					<a onclick='$.ui.toggleRightSideMenu()'
						class='button icon settings' style="float: right"></a>
					<h1>Estúdio</h1>
				</header>
				<div id="exibe_info" class="upage-content" style="overflow: auto">
					<div style="text-align: center;">
						<div id="vexflow">
						<br/>
						</div>
					</div>
				</div>
			</div>
			<!-- /Exibe partitura -->
			<footer id="af-footer">
			</footer>
		</div>
	</div>
<script>
var altPart = 750;
var escPart = 1.0;
var velPart = 3000; //timeout de 3 segundos
var comp;
var idStudio = 1;

	function scrollBlocksIntoView(numberOfBlocks, viewPortName, timeout) {
        var i = 0;
        function cb() {
            var el = $("#" + viewPortName + "_canvas" + i)[0];
            if (!el) return false;
            
            el.scrollIntoView();
            
            i++;
            console.log(i);
            if (i < numberOfBlocks) {
                setTimeout(cb, velPart);
            }
        }
        cb();
    };
	
	function scrollDiv(numberOfBlocks, container, timeout) 
	{
		var i = 0;
        function cb() {
		    $("#exibePart").animate({top:'-=130px'},'fast');
	 		i++;
		    if (i < numberOfBlocks) 
			{
	              setTimeout(cb, timeout);
	        }
        }
	    cb();
	};
    
    function drawPart(container) {
        var doc = new Vex.Flow.Document(comp);
        var formatter = doc.getFormatter();
        formatter.zoom = escPart;
        formatter.setWidth(altPart).draw($("#" + container)[0]);
 
        // Numero de blocos
        var nBlocks = formatter.measuresInBlock.length;
        scrollBlocksIntoView(nBlocks, container, 3000);
        //scrollDiv(nBlocks, container, 1000);
    };
	
	$(document).ready(function() {
		init();
		$.ui.setRightSideMenuWidth(220);
		$.ui.launch();
		$('#btn_comecarExemplo').click(function() {
			comp = ishigo;
			setTimeout(function() {
                drawPart("vexflow");
                $("#exibePart").css('overflow', 'auto');
            }, 10);
		});
		$('#btn_comecar').click(function() {
			notify(idStudio);
			comp = part_simples;
			setTimeout(function() {
                drawPart("vexflow");
                $("#exibePart").css('overflow', 'auto');
            }, 10);
		});
		$('#btn_upload').click(function() {
			//envia a partitura informada para o servidor
			var nomePart = document.getElementById("nome_part").value;
			readFile(document.getElementById("arquivo").value); //"EasyScore/chant.xml"
			sendScore(1, nomePart, partitura_lida);
		});
		$('#btn_le').click(function() {
			//envia a partitura informada para o servidor
			readFile(document.getElementById("arquivo").value);
		});
		$('#btn_criaEstudio').click(function() {
			if (createStudio(document.getElementById("criaNomeEstudio").value)) {
				alert("Estúdio " + document.getElementById("criaNomeEstudio").value + " criado com sucesso");
			};
		});
		$('#btn_selecionaPart').click(function() {
			//precisa atribuir o usu�rio ao grupo e fazer download da partitura!
			getScore();
		});
		$('#btn_configuracoes').click(function() {
			altPart = document.getElementById("rangeAltura").innerHTML;
			escPart = document.getElementById("rangeEscala").innerHTML;
			velPart = (1/(document.getElementById("rangeVelocidade").innerHTML)) * 3000; //inversamente proporcional
		});
		$('#btn_closeWeb').click(function() {
			close();
		});
		$('#consultarEstudios').click(function() {
			listStudio();
		});
		listStudio();
	});
 
	$.ui.animateHeaders = false;
</script>
</body>
</html>